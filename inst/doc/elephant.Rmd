---
title: "Study case: the African bush elephant (*Loxodonta africana*)"
author: "rcites team"
date: 10-08-2018
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Species+ information about the African bush elephant}
  %\VignetteEngine{knitr::rmarkdown}
---


```{r setup, echo = FALSE}
NOT_CRAN <- identical(tolower(Sys.getenv("NOT_CRAN")), "true")
knitr::opts_chunk$set(
  purl = NOT_CRAN,
  eval = NOT_CRAN,
  fig.align = "center",
  comment = "#> "
)
library(rcites)
```


<!-- https://cran.r-project.org/web/packages/httr/vignettes/secrets.html -->


# Introduction and setup

In [Get started with rcites](https://ibartomeus.github.io/rcites/articles/get_started.html), we explained how to get a token and set it up for general access to the CITES Species+ database. Also, we very briefly introduced to how to code the key features of `rcites`. With this article, we aim to further introduce to the functionality and workflows of `rcites`. For this, we use the African bush elephant (*Loxodonta africana*, hereafter "elephant") as a case study. The elephant not only is a highly endangered species that is illegally traded globally but also a flagship species of nature conservation and the logo species of CITES.

We start with a basic set up: we load the package and set the token:

```{r, eval = FALSE}
library(rcites)
set_token("8QW6Qgh57sBG2k0gtt")
```


# Retrieve the taxon id

In order to access information about the elephant, we first need to retrieve its
Species+ taxon identifier. For this, we use the `spp_taxonconcept()` function
and look for the elephant's scientific name, *Loxodonta africana*,
as `query_taxon` argument.

```{r}
elephant_taxonconcept <- spp_taxonconcept(query_taxon = "Loxodonta africana")
elephant_taxonconcept
```

Text about taxonconcept outcomes to come ...


## Map the elephant's distribution

Before taking more insights into the legislation status of the elephant, we have a look at where the elephant actually occurs naturally. For this, we can access the elephant's distribution information with the `spp_distributions()` function. Thereafter, we can map the distribution with the help of the `rworldmap` package.

```{r map, message = FALSE, fig.width = 6.4, fig.height = 7.6, fig.align="center"}
library(rworldmap)

par(las = 1)
ele_distr <- spp_distributions(taxon_id = "4521")$distributions
map2 <- joinCountryData2Map(ele_distr,
                            joinCode="ISO2",
                            nameJoinColumn = "iso_code2",
                            nameCountryColumn = "name")
plot(c(-23, 62), c(45, -40),
     type = "n",
     main = "Loxodonta africana",
     xlab = "Longitude",
     ylab = "Latitude")
plot(map2, add = TRUE)
plot(map2[!is.na(map2$iso_code2),], col = "#bda25d", add = TRUE)
```


## Access the legislation status

Functions `spp_cites_legislation()` and `spp_eu_legislation()` provide access to
the legislation status information of the elephant, within 1. CITES in the overall and 2. the European Union.

First, we have a look at the CITES legislation status:

```{r}
elephant_cites <- spp_cites_legislation(taxon_id = "4521")
elephant_cites
```

Text about CITES legislation outcomes to come ...

Code and Text about EU legislation outcomes to come ...

Can we make some nice map about trade directions (as a combination of map2 and the legislation data)?


## Access the elephant's Species+ reference data

Last but not least, especially scientists will probably be interested in what references the Species+ information about the elephant is based on. For this, we can access the Species+ reference data with the `spp_references()` function. Within the function, we can select to access either the taxonomic or distribution references with the `type` argument.

```{r}
elephant_refs <- spp_references(taxon_id = "4521")
```

Text about references outcomes to come ...
